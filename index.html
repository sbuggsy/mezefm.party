<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Meze FM</title>

  <!-- Keep tab icon -->
  <link rel="icon" href="favicon.png" type="image/x-icon" />

  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" />

  <script>
    // Web chat logic – connected to your n8n webhook (unchanged behaviour)
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('chat-form');
      const input = document.getElementById('chat-input');
      const messages = document.getElementById('chat-messages');

      if (!form) return; // safety if element not found

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const text = input.value.trim();
        if (!text) return;

        addMessage('You', text);
        input.value = '';

        // show temporary "thinking" message
        const thinkingId = addMessage('MezeBot', '…');

        try {
          const response = await fetch(
            'https://coralie-flectionless-karlyn.ngrok-free.dev/webhook/chat',
            {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ text }) // send { "text": "hi" }
            }
          );

          let reply = 'Sorry, the DJ bot is offline right now.';
          if (response.ok) {
            const data = await response.json().catch(() => null);
            reply = (data && (data.reply || data.message || data.text)) || reply;
          }

          updateMessage(thinkingId, 'MezeBot', reply);
        } catch (err) {
          console.error(err);
          updateMessage(thinkingId, 'MezeBot', 'Connection error – please try again in a moment.');
        }
      });

      function addMessage(sender, text) {
        const id = 'msg-' + Date.now() + Math.random().toString(16).slice(2);
        const div = document.createElement('div');
        div.className = 'chat-message ' + (sender === 'You' ? 'from-user' : 'from-bot');
        div.dataset.id = id;
        div.innerHTML = `<strong>${sender}:</strong> <span>${escapeHtml(text)}</span>`;
        messages.appendChild(div);
        messages.scrollTop = messages.scrollHeight;
        return id;
      }

      function updateMessage(id, sender, text) {
        const el = messages.querySelector(`[data-id="${id}"]`);
        if (!el) return;
        el.innerHTML = `<strong>${sender}:</strong> <span>${escapeHtml(text)}</span>`;
        messages.scrollTop = messages.scrollHeight;
      }

      function escapeHtml(str) {
        return str
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#039;');
      }
    });
  </script>

  <style>
    body {
  font-family: 'Montserrat', sans-serif;
  background-color: #f2f2f2;
  background-image: url('Background3.jpg');
  background-size: cover;          /* stretch */
  background-repeat: no-repeat;    /* no tiling */
  background-position: center;     /* center image */
  background-attachment: fixed;    /* optional: keeps it stable on scroll */
  color: #333;
  margin: 0;
  padding: 0;
    }

    header {
      margin-bottom: 20px;
      text-align: center;
    }

    header img {
      display: block;
      max-width: 50%;
      height: auto;
      margin: 120px auto;
    }

    /* Single grey panel (like in your screenshot) */
    section {
      padding: 20px;
      margin: 20px auto;
      background-color: #333333;
      color: white;
      border-radius: 10px;
      max-width: calc(100% - 40px);
      box-sizing: border-box;
    }

    /* PLAYER + CHAT LAYOUT */
    .player-chat-container {
      display: flex;
      gap: 20px;
      align-items: stretch;
      justify-content: center;
      flex-wrap: nowrap;
    }

    .player-chat-container .radio-container,
    .player-chat-container .chat-container {
      flex: 1;
      min-width: 0;
    }

    .radio-container {
      text-align: center;
      margin-top: 0;
    }

    .radio-container iframe {
      width: 100%;
      max-width: 100%;
      height: 330px;
      border: 0;
    }

    /* CHAT WIDGET */
    .chat-container {
      background-color: #222;
      border-radius: 10px;
      padding: 10px;
      display: flex;
      flex-direction: column;
    }

    .chat-header {
      font-weight: 700;
      text-transform: uppercase;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .chat-messages {
      flex: 1;
      background-color: #111;
      border-radius: 8px;
      padding: 8px;
      overflow-y: auto;
      max-height: 330px;
      font-size: 13px;
    }

    .chat-message {
      margin-bottom: 6px;
      line-height: 1.3;
    }

    .chat-message.from-user strong {
      color: #ffcc00;
    }

    .chat-message.from-bot strong {
      color: #66d9ff;
    }

    .chat-input-area {
      margin-top: 8px;
      display: flex;
      gap: 6px;
    }

    .chat-input-area input[type="text"] {
      flex: 1;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #555;
      background: #222;
      color: #fff;
    }

    .chat-send-btn {
      padding: 8px 14px;
      border-radius: 6px;
      border: none;
      background-color: #ffcc00;
      color: #333333;
      cursor: pointer;
      font-weight: 700;
      text-transform: uppercase;
      font-size: 12px;
    }

    .chat-send-btn:hover {
      background-color: #ffd633;
    }

    /* Responsive */
    @media screen and (max-width: 768px) {
      .player-chat-container {
        flex-direction: column;
      }
      .radio-container iframe {
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <!-- Logo only -->
  <header>
    <img src="logo_without_background.png" alt="Meze FM Logo" />
  </header>

  <!-- Single section: player + chat only -->
  <section id="home">
    <div class="player-chat-container">
      <div class="radio-container">
        <iframe
          width="330"
          height="330"
          src="https://media2.streambrothers.com:2020/public/8054?mount=&"
          frameborder="0"
        ></iframe>
      </div>

      <div class="chat-container">
        <div class="chat-header">Chat with MezeBot</div>
        <div id="chat-messages" class="chat-messages"></div>

        <form id="chat-form" class="chat-input-area">
          <input id="chat-input" type="text" placeholder="Say hi to the DJ bot…" autocomplete="off" />
          <button class="chat-send-btn" type="submit">Send</button>
        </form>
      </div>
    </div>
  </section>
</body>
</html>
